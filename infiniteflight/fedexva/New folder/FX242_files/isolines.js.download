/*! */
W.tag("isolines","",".labels-high-lows,.labels-isoline{position:relative;pointer-events:none}.labels-high-lows div,.labels-isoline div{position:absolute;white-space:nowrap;letter-spacing:.08em}.labels-high-lows{z-index:11;pointer-events:auto}.labels-high-lows div{font-size:10px;line-height:1;margin:0;padding:0;text-shadow:0 0 4px black;width:40px;margin-top:-12.5px;margin-left:-20px;text-align:center}.labels-high-lows div span{font-size:15px;display:block}.labels-isoline{z-index:10}.labels-isoline div{font-size:7px;background-color:#aaffff;color:#6b6b6b;padding:.15em .3em;border-radius:1.2em;margin-top:-0.7em;line-height:1;transform-origin:left}","",function(e){var t=W.require;t("isolines"),t("IsolinesCanvas2D")}),
/*! */
W.define("IsolinesCanvas2D",["overlays","rootScope","utils"],function(H,N,_){return L.CanvasLayer.extend({_canvas:null,context:null,ratioScale:1,onInit:function(){this.targetPane="overlayPane"},onCreateCanvas:function(){return this.getCanvas().classList.add("isolines-layer"),this.context=this.getCanvas().getContext("2d"),!0},onCanvasFailed:function(){this.context=null},onRemoveCanvas:function(){this.context=null},onResizeCanvas:function(e,t){var i=Math.min(window.devicePixelRatio||1,2),n=this.getCanvas();this.ratioScale=i,n.width=e*i,n.height=t*i,n.style.width=e+"px",n.style.height=t+"px"},onReset:function(){this.draw()},epsilon:1e-4,compareFloats:function(e,t){return Math.abs(e-t)<this.epsilon},dist2D:function(e,t,i,n){var o=i-e,s=n-t;return Math.sqrt(o*o+s*s)},isLoop:function(e,t,i,n){return Math.abs(e-i)%1<1e-4&&Math.abs(t-n)%1<1e-4},appendPoints:function(e,t,i,n){var o,s,a,r,l,h,f,d,c,v,u;o=t[i+1],s=t[i];var g=1;0==i?this.isLoop(o,s,t[n-1],t[n-2])?(a=t[i+1]-t[n-1]+t[n-3],r=t[i]-t[n-2]+t[n-4]):(a=2*o-t[3],r=2*s-t[2],g=0):(a=t[i-1],r=t[i-2]),n-2<=i?this.isLoop(t[1],t[0],t[n-1],t[n-2])?(l=t[i+1]-t[1]+t[3],h=t[i]-t[0]+t[2]):(l=2*o-t[i-1],h=2*s-t[i-2],g=0):(l=t[i+3],h=t[i+2]);var p=(0<(o-a)*(d=h-r)-(s-r)*(f=l-a)?-.025:.025)*g,m=this.dist2D(l,h,a,r);.02<m&&(p*=.02/m);var b=d*p,w=-f*p;c=(u=.25/m)*this.dist2D(o,s,a,r),v=u*this.dist2D(l,h,o,s),o+=b,s+=w,e.push(o-c*f,s-c*d,o,s,o+v*f,s+v*d)},newData:function(e){var t,i,n,o,s;this.ident=e.params.isolines;var a=[];for(i=0;i<e.isoline.length;i++){var r=e.isoline[i],l=[],h=r.bbox;for(o=r.points,n=r.points.length,t=0;t<n;t+=2)o[t]=_.latDegToYUnit(o[t]),o[t+1]=_.lonDegToXUnit(o[t+1]);for(t=0;t<n;t+=2)this.appendPoints(l,o,t,n);var f=[_.lonDegToXUnit(h[3]),_.latDegToYUnit(h[0]),_.lonDegToXUnit(h[1]),_.latDegToYUnit(h[2])];a.push({data:l,value:r.value,data0:o,bb:f,rgba:e.colorFn(r.value)})}for(this.curves=a,this.hilo=[],s=e.low.value,o=e.low.points,n=s.length,t=0;t<n;t++)this.hilo.push(s[t],_.lonDegToXUnit(o[t+t+1]),_.latDegToYUnit(o[t+t]));for(this.highStartOffset=3*n,s=e.high.value,o=e.high.points,n=s.length,t=0;t<n;t++)this.hilo.push(s[t],_.lonDegToXUnit(o[t+t+1]),_.latDegToYUnit(o[t+t]));this.data=e,this.draw()},draw:function(){if(this.curves&&this.context){var l=this.context;l.save();for(var e,t,i=N.map,n=[_.lonDegToXUnit(i.west),_.latDegToYUnit(i.north),_.lonDegToXUnit(i.east),_.latDegToYUnit(i.south)];n[0]<0;)n[0]+=1,n[2]+=1;for(;1<n[0];)n[0]-=1,n[2]-=1;var o=this.getCanvas().width,s=this.getCanvas().height,h=o/(n[2]-n[0]),f=s/(n[3]-n[1]),a=-h*n[0],d=-f*n[1],r=1+Math.max(0,Math.min(.14*(i.zoom-3),1)),c=r*this.ratioScale,v=H[this.ident].convertNumber;l.clearRect(0,0,o,s),l.lineWidth=r,l.font=2+6*c+"px sans-serif";var u,g,p,m,b,w,x,T,C=.05*(o+s),D=C,y=C,U=o-C,z=s-C,S=function(e){l.beginPath(),l.moveTo(u[2]*h+e,u[3]*f+d);for(var t=4;t<g;t+=6){var i=u[t+4]*h+e,n=u[t+5]*f+d,o=u[t+2]*h+e,s=u[t+3]*f+d;if(l.bezierCurveTo(u[t]*h+e,u[t+1]*f+d,o,s,i,n),p&&b<0&&D<i&&i<U&&y<n&&n<z){var a=i-o,r=n-s;4*r*r<a*a&&(b=t+4,m=i,w=n,x=a,T=r)}}l.stroke()};for(t=0;t<this.curves.length;t++){var M=this.curves[t];u=M.data,g=M.data.length,b=-1,p=3<i.zoom&&48<g&&(4<i.zoom||M.value%400);for(var F=[],L=0;L<4;L+=2)F.push(M.bb[L]*h+a,M.bb[L+1]*f+d);var P="rgba( "+M.rgba[0]+", "+M.rgba[1]+", "+M.rgba[2]+",";if(l.strokeStyle=P+"0.8)",l.fillStyle=P+"0.9)",F[1]<s&&0<F[3]&&(F[0]<o&&0<F[2]&&S(a),F[0]+h<o&&0<F[2]+h&&S(a+h),F[0]-h<o&&0<F[2]-h&&S(a-h)),0<b){l.save();var X=Math.atan(T/x);l.translate(m,w),l.rotate(X);var Y=v(M.value),k=4*c,R=Math.max(.9*l.measureText(Y).width,2*k),I=.5*R;l.beginPath(),l.moveTo(-I,k),l.lineTo(I,k),l.bezierCurveTo(R,k,R,-k,I,-k),l.lineTo(-I,-k),l.bezierCurveTo(-R,-k,-R,k,-I,k),l.fill(),l.fillStyle="black",l.textAlign="center",l.fillText(Y,0,1+2*c),l.restore()}}l.textAlign="center",l.fillStyle="#FFFF",l.font="20px sans-serif",l.shadowColor="#000F",l.shadowBlur=3,l.shadowOffsetX=1,l.shadowOffsetY=1,g=this.hilo.length;var W="L",O=Math.round(16*c-4)+"px sans-serif",A=Math.round(1+8*c)+"px sans-serif",q=5*c;for(e=0;e<g;e+=3){e==this.highStartOffset&&(W="H");var B=this.hilo[e+1]*h+a,E=this.hilo[e+2]*f+d;if(B<0&&(B+=h),B<o&&0<B&&0<E&&E<s){var j=this.hilo[e],G=this.data.colorFn(j);l.fillStyle="rgb( "+G[0]+", "+G[1]+", "+G[2]+")",l.font=O,l.fillText(W,B,E-q),l.font=A,l.fillText(v(this.hilo[e]),B,E+q)}}l.restore()}}})}),
/*! */
W.define("isolines",["rootScope","broadcast","map","http","render","Color","IsolinesCanvas2D","products","store"],function(r,t,i,l,h,e,n,f,d){var c,v=new n,u="",g=0,p=[170,255,255,255],m=e.instance({ident:"pressureIsolines",steps:50,default:[[99e3,[215,250,255,255]],[100900,[187,213,255,255]],[101500,[202,255,197,255]],[101900,[253,255,185,255]],[102200,[255,235,193,255]],[102500,[255,210,201,255]],[103e3,[255,206,236,255]]]});function o(){c&&(u=null,s(c))}function s(e){var t,i,n=(c=e).isolines,o=("pressure"===n||"temp"===n)&&/^ecmwf-hres|^gfs|^icon|^nam/.test(e.directory)||"gh"===n&&/^ecmwf-hres|^gfs|^icon/.test(e.directory)?e.directory:"ecmwf"===d.get("prefferedProduct")?"ecmwf-hres":"gfs";if(e.directory!==o){var s=f.ecmwf.calendar;t=s.ts2path(d.get("timestamp")),i=s.refTime}else t=e.path,i=e.refTime;var a=r.server+"/"+o+"/"+t+"/siw0/0/0/"+e.isolines+"-"+e.level+".json?reftime="+i;a!==u?(g++,l.get(a).then(function(e,t,i){var n=i.data;if(!n||g!==e)return;n.params=c,n.colorFn="pressure"===c.isolines?m.RGBA.bind(m):function(){return p},v.newData(n),h.emit("rendered","isolines")}.bind(null,g,e)).catch(window.wError.bind(null,"isolines","Error loading/rendering isolines")),u=a):h.emit("rendered","isolines")}return m.getColor(),{redraw:function(){return h.emit("rendered","isolines")},onopen:function(e){v.addTo(i),document.body.classList.add("onisolines"),s(e),t.on("metricChanged",o)},paramsChanged:s,onclose:function(){i.removeLayer(v),t.off("metricChanged",o),u=null,document.body.classList.remove("onisolines")}}});